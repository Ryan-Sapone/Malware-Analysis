<h1>LetsDefend Analysis - Follina (CVE-2022-30190)</h1>
As part of a final project for the PMAT course, I wanted to analyze potential malware from outside of the course repository and put my SOC Analyst skills to the test. This will be a brief walkthrough of a SIEM alert I received for the Follina Zero-Day detection. Here is what the alert on my SIEM dashboard looked like, and how I took ownership of this alert to investigate it.
<img src="https://user-images.githubusercontent.com/107446796/187539022-2c04d7f0-0cf6-486a-a2df-30790779d385.png">

I created a case and downloaded the ZIP file to transfer onto my secure environment (NOTE: the testing environment did not have Microsoft Word installed on it, so the only analysis I could perform was static analysis). </br></br>

I started out by checking for symptoms of the malware on the host. I reviewed browser logs from the date of the reported malware June 2nd (02.06.2022) which only yielded one result. 

<img src="https://user-images.githubusercontent.com/107446796/187539602-a9d914e6-de7d-42a1-999b-a6d15c78cf86.png">

From there, I checked the command history, which showed some suspicious behavior. 
<img src="https://user-images.githubusercontent.com/107446796/187539753-d94bff33-bab8-47d7-9585-48912ebe45cf.png">

From there, I viewed network connections on the dates before and after the alert. This connection showed up multiple times, so I was able to rule out this being a potential C2 server.

<img src="https://user-images.githubusercontent.com/107446796/187540361-a1e709ee-763a-4eff-83e9-60d43565a97a.png">

I then looked at the processes on the host and was able to view the cmd.exe process as well as msdt.exe. Follina takes advantage of the Microsoft Windows Support Diagnostics Tool (MSDT) and provides a vector for remote code execution. (Read more here: https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2022-30190).

<img src="https://user-images.githubusercontent.com/107446796/187541221-be519583-cf13-45d4-8a51-dfe33d285f0e.png">
<img src="https://user-images.githubusercontent.com/107446796/187541240-df346575-c8da-4c70-bc21-43bc98fb7ea0.png">

At this point, I had enough suspicion that this was malware, and so now it was time to quarantine the host. 

<img src="https://user-images.githubusercontent.com/107446796/187541488-418612d0-2f42-4d39-97ce-f787b7511089.png">

By using PEStudio on my secure host, I was able to obtain the MD5 and SHA256 hashes for this file and check it on VirusTotal - it was no surprise that it was identified as a malicious file. 

<img src="https://user-images.githubusercontent.com/107446796/187541697-78e6020a-dc17-4147-882a-6c9a5bb5e24c.png">

Something that I learned from the PMAT course was that all Office files are technically ZIP files with other documents inside of them. So by changing this to a ZIP file, you can view those internal files. 

<img src="https://user-images.githubusercontent.com/107446796/187542207-15dd882e-7736-40fa-9fb0-697ae9980202.png">

Something that I learned further in the PMAT course as well as verified with reading the CVE documentation is that these metadata files (document.xml.rels) can be changed to pull from external sources. In this screenshot, you can see that this file is requesting a resource from an external source. By further checking the host's networking logs, we can see that this resource was accessed.

<img src="https://user-images.githubusercontent.com/107446796/187543430-9d4b229c-8f0b-4605-897f-7c2969e13823.png">
<img src="https://user-images.githubusercontent.com/107446796/187543756-def002a2-c604-49fa-8886-9c96d780252b.png">
<img src="https://user-images.githubusercontent.com/107446796/187544133-280949f0-60df-45c8-994d-aa3ce86fc232.png">

Now on LetsDefend, the important artifact details are added and the case can be closed. In the real world, there would be more steps, however this is just practicing on a SIEM system and getting used to analysis. You can see below that I only lost points on identifying whether the malware was quarantined or not - I rushed it and thought that it was asking if I quarantined the system. Oh well. But in the end I was (mostly) correct with my analysis, and following the walkthrough afterwards, I nailed all of the important information. 

<img src="https://user-images.githubusercontent.com/107446796/187544559-d3d1783c-ac19-4e52-84b4-f1d1ceac2183.png">
